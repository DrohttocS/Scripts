

$path = "C:\temp\StaleUser90Days.csv"
$DaysInactive = 90 
$time = (Get-Date).Adddays(-($DaysInactive))
# Get all AD User with lastLogonTimestamp less than our time and set to enable
Get-ADUser -Filter {LastLogonDate -gt $time -and Enabled -eq $true}  -Properties *  |
# Output Name and lastLogonTime into CSV 
select-object DisplayName,sAMAccountName,Name,Surname,GivenName,sn,cn,WhenCreated,WhenChanged,LastLogonDate,Enabled,LogonCount,PasswordNeverExpires,PasswordLastSet,CanonicalName,DistinguishedName,AccountExpirationDate,LogonWorkstations,UserPrincipalName,userWorkstations,AccountLockoutTime,Modified,modifyTimeStamp,ObjectClass,pwdLastSet,LastBadPasswordAttempt,PasswordNotRequired,accountExpires,PrimaryGroup,primaryGroupID,SmartcardLogonRequired,MobilePhone,telephoneNumber,Office,OfficePhone,memberof,ObjectCategory,ObjectGUID,objectSid,MNSLogonAccount,OtherName,Organization,nTSecurityDescriptor,POBox,PostalCode,ProfilePath,ProtectedFromAccidentalDeletion,proxyAddresses,sAMAccountType,ScriptPath,sDRightsEffective,ServicePrincipalNames,showInAddressBook,SID,SIDHistory,State,StreetAddress,textEncodedORAddress,Title,TrustedForDelegation,TrustedToAuthForDelegation,UseDESKeyOnly,userAccountControl,userCertificate,uSNChanged,uSNCreated,AccountNotDelegated,AllowReversiblePasswordEncryption,BadLogonCount,badPasswordTime,badPwdCount,CannotChangePassword,City,codePage,Company,Country,countryCode,Created,createTimeStamp,Deleted,Department,Division,DoesNotRequirePreAuth,dSCorePropagationData,mail,EmailAddress,mailNickname,EmployeeID,EmployeeNumber,Fax,HomeDirectory,HomedirRequired,HomeDrive,homeMDB,homeMTA,HomePage,HomePhone,Initials,instanceType,isDeleted,LastKnownParent,lastLogon,lastLogonTimestamp,legacyExchangeDN,LockedOut,lockoutTime,Manager,mDBUseDefaults,msDS-User-Account-Control-Computed,msExchALObjectVersion,msExchHomeServerName,msExchMailboxGuid,msExchMailboxSecurityDescriptor,msExchPoliciesIncluded,msExchUserAccountControl,Description,Certificates,@{Name="Date"; Expression={[DateTime]::FromFileTime($_.lastLogonDate,$_.lastLogonTimeStamp).ToString('yyyy-MM-dd_hh:mm:ss')}} | export-csv -Path $path -notypeinformation -Encoding UTF8